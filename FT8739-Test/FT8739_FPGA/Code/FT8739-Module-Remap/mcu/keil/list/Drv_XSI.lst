C251 COMPILER V5.54.0.0,  Drv_XSI                                                          14/04/17  16:04:05  PAGE 1   


C251 COMPILER V5.54.0.0, COMPILATION OF MODULE Drv_XSI
OBJECT MODULE PLACED IN .\obj\Drv_XSI.obj
COMPILER INVOKED BY: D:\Program Files (x86)\keil\C251\BIN\C251.EXE ..\..\src\source\driver\Drv_XSI.c XSMALL ROM(HUGE) OP
                    -TIMIZE(9,SPEED) BROWSE INCDIR(..\..\src\include;..\..\src\include\Debug;..\..\src\include\Drv;..\..\src\include\task) ST
                    -RING(FAR) DEBUG PRINT(.\list\Drv_XSI.lst) TABS(2) OBJECT(.\obj\Drv_XSI.obj) 

stmt  level    source

    1          /*******************************************************************************
    2          * Copyright (C) 2012-2014, FocalTech Systems (R)£¬All Rights Reserved.
    3          *
    4          * File Name: Drv_XSI.c
    5          *
    6          *    Author: xinkunpeng
    7          *
    8          *   Created: 2014-05-14
    9          *
   10          *  Abstract:
   11          *
   12          * Reference:
   13          *
   14          *   Version:
   15          *
   16          *******************************************************************************/
   17          #include "Drv_XSI.h"
   18          #include "FT8836_Reg.h"
   19          
   20          /*******************************************************************************
   21          * 1.Included header files
   22          *******************************************************************************/
   23          
   24          /*******************************************************************************
   25          * 2.Private constant and macro definitions using #define
   26          *******************************************************************************/
   27          
   28          /*******************************************************************************
   29          * 3.Private enumerations, structures and unions using typedef
   30          *******************************************************************************/
   31          ST_XSIRegisters * XRAM pXSI0Regs = (volatile ST_XSIRegisters *)XSI0_REG_BASE_ADDR;
   32          ST_XSIRegisters * XRAM pXSI1Regs = (volatile ST_XSIRegisters *)XSI1_REG_BASE_ADDR;
   33          
   34          /*******************************************************************************
   35          * 4.Static variables
   36          *******************************************************************************/
   37          
   38          /*******************************************************************************
   39          * 5.Global variable or extern global variabls/functions
   40          *******************************************************************************/
   41          
   42          /*******************************************************************************
   43          * 6.Static function prototypes
   44          *******************************************************************************/
   45          
   46          /*******************************************************************************
   47          *   Name: Drv_Xsi0Init
   48          *  Brief:
   49          *  Input:
   50          * Output:
   51          * Return:
   52          *******************************************************************************/
   53          void Drv_XsiInit()
   54          {
   55   1          AFECKEN  = 1;
   56   1          XSICKEN = 1;
   57   1      
C251 COMPILER V5.54.0.0,  Drv_XSI                                                          14/04/17  16:04:05  PAGE 2   

   58   1          //XSI_SEL = 0; //CPU·ÃÎÊXSI
   59   1      
   60   1          // clk sel
   61   1          pXSI0Regs->Clksel = 1;
   62   1          pXSI1Regs->Clksel = 1;
   63   1         // pXSI2Regs->Clksel = 3;
   64   1      
   65   1          //LCD_XSI_CLKEN = 0; 
   66   1          //LCD_XSI_CLKEN = 0x5A;
   67   1      
   68   1         /* while(LCD_XSI_CLKEN!=1)
   69   1          {
   70   1              DBG_FLOW("\n\rLCD_XSI_CLKEN = %x",LCD_XSI_CLKEN);
   71   1          }*/
   72   1      }
   73          
   74          /*******************************************************************************
   75          *   Name: Drv_XsiReadReg
   76          *  Brief:
   77          *  Input:
   78          * Output:
   79          * Return:
   80          *******************************************************************************/
   81          UINT16 Drv_XsiReadReg(ST_XSIRegisters *pXSIRegs, UINT16 usAddr, UINT8 flag)
   82          {
   83   1          UINT16 tmp;
   84   1          XSI_SEL = 0;
   85   1      
   86   1          //pXSIRegs->Stop = 1;
   87   1          //while (pXSIRegs->Stop);  
   88   1      
   89   1          pXSIRegs->Wdata  = (0<<XSI_WDATA_WR) + (flag<<XSI_WDATA_SEL) + usAddr;
   90   1          while (!pXSIRegs->Tx_int);
   91   1      
   92   1          pXSIRegs->Wdata = XSI_WDATA_DUMMY; // dummy
   93   1          while (!pXSIRegs->Tx_int);
   94   1      
   95   1          tmp = pXSIRegs->Rdata;
   96   1          pXSIRegs->Stop = 1;
   97   1          while (pXSIRegs->Stop);
   98   1          XSI_SEL = 1;
   99   1      
  100   1          return tmp;
  101   1      }
  102          
  103          /*******************************************************************************
  104          *   Name: Drv_XsiWriteReg
  105          *  Brief:
  106          *  Input:
  107          * Output:
  108          * Return:
  109          *******************************************************************************/
  110          void Drv_XsiWriteReg(ST_XSIRegisters *pXSIRegs, UINT16 usAddr, UINT16 usData,UINT8 flag)
  111          {
  112   1          XSI_SEL = 0;
  113   1          //pXSIRegs->Stop = 1;
  114   1          //while (pXSIRegs->Stop);    
  115   1      
  116   1          pXSIRegs->Wdata = (1<<XSI_WDATA_WR) + (flag<<XSI_WDATA_SEL) + usAddr;
  117   1          while (!pXSIRegs->Tx_int);
  118   1      
  119   1          pXSIRegs->Wdata = usData;
  120   1          while (!pXSIRegs->Tx_int);
  121   1          pXSIRegs->Stop = 1;
  122   1          while (pXSIRegs->Stop);
  123   1          XSI_SEL = 1;
C251 COMPILER V5.54.0.0,  Drv_XSI                                                          14/04/17  16:04:05  PAGE 3   

  124   1      }
  125          
  126          /*******************************************************************************
  127          *   Name: Drv_XsiRead
  128          *  Brief:
  129          *  Input:
  130          * Output:
  131          * Return:
  132          *******************************************************************************/
  133          void Drv_XsiRead(ST_XSIRegisters *pXSIRegs, UINT16 usAddr, UINT16 *pBuf, UINT16 len, UINT8 flag)
  134          {
  135   1          UINT8 i;
  136   1      
  137   1          XSI_SEL = 0;
  138   1          //pXSIRegs->Stop = 1;
  139   1          //while (pXSIRegs->Stop);      
  140   1      
  141   1          pXSIRegs->Wdata  = (0<<XSI_WDATA_WR) + (flag<<XSI_WDATA_SEL) + usAddr;
  142   1          while (!pXSIRegs->Tx_int);
  143   1      
  144   1          for (i = 0; i < len; i++)
  145   1          {
  146   2              pXSIRegs->Wdata = XSI_WDATA_DUMMY;   // dummy
  147   2              while (!pXSIRegs->Tx_int);
  148   2      
  149   2              *pBuf++ = pXSIRegs->Rdata;
  150   2          }
  151   1          
  152   1          pXSIRegs->Stop = 1;
  153   1          while (pXSIRegs->Stop);
  154   1          XSI_SEL = 1;
  155   1      }
  156          
  157          /*******************************************************************************
  158          *   Name: Drv_XsiWrite
  159          *  Brief:
  160          *  Input:
  161          * Output:
  162          * Return:
  163          *******************************************************************************/
  164          void Drv_XsiWrite(ST_XSIRegisters *pXSIRegs, UINT16 usAddr, UINT16 *pBuf, UINT8 len, UINT8 flag)
  165          {
  166   1          UINT8 i;
  167   1          XSI_SEL = 0;
  168   1      
  169   1          //pXSIRegs->Stop = 1;
  170   1          //while (pXSIRegs->Stop);      
  171   1      
  172   1          pXSIRegs->Wdata = (1<<XSI_WDATA_WR) + (flag<<XSI_WDATA_SEL) + usAddr;
  173   1          while (!pXSIRegs->Tx_int);
  174   1      
  175   1          for (i = 0; i < len; i++)
  176   1          {
  177   2              pXSIRegs->Wdata = *pBuf++;
  178   2              while (!pXSIRegs->Tx_int);
  179   2          }
  180   1          pXSIRegs->Stop = 1;
  181   1          while (pXSIRegs->Stop);
  182   1          XSI_SEL = 1;    
  183   1      }
  184          
  185          #if _TEST_XSI_EN
               /*******************************************************************************
               *   Name: Test_Xsi()
               *  Brief:
               *  Input:
C251 COMPILER V5.54.0.0,  Drv_XSI                                                          14/04/17  16:04:05  PAGE 4   

               * Output:
               * Return:
               *******************************************************************************/
               void Test_Xsi()
               {
                   UINT8 i,j;
                   UINT8 len;
                   UINT16 k = 0;
                   UINT16 XRAM Buf1[200];
                   UINT16 XRAM Buf2[200];
                   UINT16 XRAM Buf3[200];
               
                   DBG_MODE("\n\rXSI test is start");
                   Drv_XsiInit();
                   len = 200;
                   for (i = 0; i < len; i++)
                   {
                       Buf3[i] = 5 + i;
                   }
                   
                   while (1)
                   {
                       for (j = 0; j < 200; j++)
                       {
                           for (i = 0; i < len; i++)
                          {
                               Buf1[i] = i + Buf3[j];
                          }
                           Drv_XsiWrite(pXSI0Regs,256,Buf1,len,XSI_S_REG);
                           Drv_XsiRead(pXSI0Regs,256,Buf2,len,XSI_S_REG);
                           for (i = 0; i < len; i++)
                           {
                               if (Buf1[i] != Buf2[i])                
                               {
                                   DBG_ERROR("\n\rBuf1[%02d]: %04x,Buf2[%02d]: %04x",i,Buf1[i],i,Buf2[i]);
                                   break;
                               }
                           }
                           DelayMs(10);
                       }
                       k++;
                       DBG_XSI("\n\rCounter: %06d",k);
                   }
                   DBG_MODE("\n\rXSI test is end");
               }
               #endif
  236          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =    ------     ------
  ecode size           =       331     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =         8         13
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        16     ------
C251 COMPILER V5.54.0.0,  Drv_XSI                                                          14/04/17  16:04:05  PAGE 5   

End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
